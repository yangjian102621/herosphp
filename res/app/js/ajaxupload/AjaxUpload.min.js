$("head").append('<link type="text/css" rel="stylesheet" href="dist/skin/ajax-upload.min.css">');var AjaxUpload=function(e){function n(){var n='<div class="jupload-container" id="jupload-container">		<div class="jupload-panel" id="jupload-panel">         <div class="image-list-box" id="image-list-box">         </div>     </div>     <div class="jupload-btn-box" id="jupload-btn-box">         <button class="btn-upload"></button>         <button class="btn-add-file"></button>     </div></div>';$("body").append(n);var o=$('<div class="init-add-file-btn" id="init-add-file-btn"></div>'),d=$('<input type="file" class="input-select-file" id="input-select-file" multiple="true">'),s=$('<div class="addmore-box" id="addmore-box"><span class="addmore-btn"></span></div>');s.on("click",function(){$("#input-select-file").trigger("click")}),$("#jupload-btn-box .btn-add-file").on("click",function(){return u.length>0?(alert("请先上传文件！"),!1):(m.length>0&&e.callback(m),void $("#jupload-container").remove())}),$("#jupload-btn-box .btn-upload").on("click",function(){return 0==u.length?(alert("请至少添加一个文件！"),!1):void t(u.shift())}),d.on("change",function(){0==$("#image-list-box").find(".addmore-box").length?$("#image-list-box").append(s):s.show();for(var n=d[0].files,t=$("#jupload-container .img-container").length,o=t;o<t+n.length;o++){if(u.length>=e.maxFileNum){alert("您本次最多上传"+e.maxFileNum+"个文件.");break}var l=$('<div class="img-container" id="img-comtainer-'+o+'">    <div class="image">       <img src="'+window.URL.createObjectURL(n[o-t])+'" width="150px;" border="0">       <div class="mask">等待上传……</div>     </div>     <div class="file-info">         <div class="progress"><span class="progress-bar" id="upload-progress-bar-'+o+'"></span></div>         <div class="file-size">'+a(n[o-t].size)+'</div>     </div>     <span class="remove" index="'+o+'"></span>     <span class="success"></span></div>');l.find(".remove").on("click",function(){i(this)}),$("#jupload-container  #addmore-box").before(l),u.push(n[o-t])}$("#init-add-file-btn").hide()}),o.append(d),$("#jupload-panel").append(o),o.css({top:($("#jupload-panel").height()-o.height())/2+"px",left:($("#jupload-panel").width()-o.width())/2+"px"});var l=window.document.body.scrollTop||window.document.documentElement.scrollTop,r=$("#jupload-container");r.css({top:l+20+"px",left:($(window).width()-r.width())/2})}function i(e){$(e).parent().remove();var n=$(e).attr("index");u.splice(n,1),0==$(".img-container").length&&($("#init-add-file-btn").show(),addMoreImage.hide()),$("#image-list-box").find(".remove").each(function(e,n){$(n).attr("index",e)})}function a(e){return e/1048576>1?(e/1048576).toFixed(2)+"MB":(e/1024).toFixed(2)+"KB"}function t(n){if(!o(n))return f++,void l();var i=new XMLHttpRequest;i.open("POST",e.uploadUrl),i.addEventListener("load",function(n){if("json"==e.dataType){var i=$.parseJSON(n.target.responseText);0==i.code?(m.push(i.message),$("#img-comtainer-"+f).find(".remove").hide().next().show(),$("#img-comtainer-"+f).find(".mask").hide()):$("#img-comtainer-"+f).find(".mask").html(p[i.code]).addClass("error")}e.onSuccess(n)},!1),i.addEventListener("loadend",function(){f++,l()},!1),i.addEventListener("error",function(n){e.onError(n)},!1),i.upload.addEventListener("progress",function(e){r(e)},!1),i.upload.addEventListener("loadstart",function(n){e.onLoadStart(n)},!1);var a=new FormData;a.append(e.src,n),i.send(a)}function o(n){var i=1024*e.maxFileSize;if(i>0&&n.size>i)return s("文件大小不能超过 "+e.maxFileSize+" KB"),!1;var a=d(n.name);return a&&-1!=e.extAllow.indexOf(a)&&-1==e.extRefuse.indexOf(a)?!0:(s("非法的文件后缀 "+a),!1)}function d(e){var n=e.lastIndexOf(".");return-1!=n?e.substr(n+1).toLowerCase():!1}function s(e){$("#img-comtainer-"+f).find(".mask").html(e).addClass("error")}function l(){if(u.length){var n=u.shift();t(n)}else e.onComplete(),f=0,u=new Array}function r(e){e.lengthComputable&&$("#upload-progress-bar-"+f).css({width:e.loaded/e.total*100+"%"})}if(!window.applicationCache)throw"Your browser version is too low, do not support html5, can not be used AjaxUpload upload the plugin, please upgrade your browser!";var c={src:"src",uploadUrl:null,dataType:"json",maxFileSize:2048,maxFileNum:20,extAllow:"jpg|png|gif|jpeg",extRefuse:"exe|txt",callback:function(e){},onSuccess:function(e){},onError:function(e){},onLoadStart:function(e){},onComplete:function(){$("#addmore-box").hide()}},p={0:"文件上传成功",1:"文件上传失败",2:"文件大小超出限制",3:"非法文件名后缀"};e=$.extend(c,e);var u=new Array,f=0,m=new Array;n()};